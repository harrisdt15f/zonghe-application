{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Common/assets\\Script\\Common\\ListViewCommon.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Common","sourcesContent":["\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ListViewCommon extends cc.Component {\n\n    @property(cc.ScrollView)\n    scroll_view:cc.ScrollView = null;\n    @property(cc.Node)\n    item_prefab:cc.Node =null;\n\n    private OPT_HEIGHT = 35;  // 每项的高度\n    private PAGE_NUM = 16;  // 每页预加载个数;\n\n    private value_set = null;\n    private opt_item_set = null;\n    \n    private content = null;\n\n    private start_y = 0;\n    private start_index = 0;\n    private childNum = 0;\n\n    private fback = null;\n\n    init(number,itemHeight,fback)\n    {\n        this.fback = fback;\n        this.value_set = [];\n        // 如果你这里是排行榜，那么你就push排行榜的数据;\n        for(var i = 1; i <= number; i ++) {\n            this.value_set.push(i);\n        }\n        this.content = this.scroll_view.content;\n        this.opt_item_set = [];\n        let max =Math.min(this.PAGE_NUM * 3,number);\n        for(var i = 0; i < max; i ++) {\n            var item = cc.instantiate(this.item_prefab);\n            item.active = true;\n            this.content.addChild(item);\n            this.opt_item_set.push(item);\n            if(this.fback)\n            {\n                this.fback(i,this.opt_item_set[i]);  //返回item 索引，和 当前itemPrefab\n            }\n        }\n        this.OPT_HEIGHT =itemHeight;\n        this.scroll_view.node.on(\"scroll-ended\", this.on_scroll_ended.bind(this), this);\n        this.start_y = this.content.y;\n        this.start_index = 0; // 当前我们24个Item加载的 100项数据里面的起始数据记录的索引;\n        this.load_record(this.start_index);\n        this.childNum = number;\n    }\n    /*\n    // use this for initialization\n    onLoad() {\n        this.value_set = [];\n        // 如果你这里是排行榜，那么你就push排行榜的数据;\n        for(var i = 1; i <= 100; i ++) {\n            this.value_set.push(i);\n        }\n        \n        this.content = this.scroll_view.content;\n        this.opt_item_set = [];\n        for(var i = 0; i < this.PAGE_NUM * 3; i ++) {\n            var item = cc.instantiate(this.item_prefab);\n            this.content.addChild(item);\n            this.opt_item_set.push(item);\n        }\n\n        this.scroll_view.node.on(\"scroll-ended\", this.on_scroll_ended.bind(this), this);\n    }\n    */\n    start() {\n       // this.start_y = this.content.y;\n      //  this.start_index = 0; // 当前我们24个Item加载的 100项数据里面的起始数据记录的索引;\n      //  this.load_record(this.start_index);\n    }\n\n    // 从这个索引开始，加载数据记录到我们的滚动列表里面的选项\n    load_record(start_index) {\n        this.start_index = start_index;\n        let max =Math.min(this.PAGE_NUM * 3,this.childNum); \n        for(var i = 0; i < max; i ++) {\n            if(this.fback)\n            {\n                this.fback(this.value_set[start_index + i],this.opt_item_set[i]);  //返回item 索引，和 当前itemPrefab\n            }\n        }\n    }\n\n    on_scroll_ended() {\n        this.scrollveiw_load_recode();\n        this.scroll_view.elastic = true;\n    }\n\n    scrollveiw_load_recode() {\n        //console.log(\"this.start_index \"+this.start_index+\"  this.PAGE_NUM * 3  \"+this.PAGE_NUM * 3+\"  this.value_set.length \"+this.value_set.length);\n        //console.log(\" this.content.y  \"+ this.content.y+\"  this.start_y  \"+this.start_y +\"  this.PAGE_NUM  \"+this.PAGE_NUM+\"  this.OPT_HEIGHT \"+this.OPT_HEIGHT);\n         // 向下加载了\n        if (this.start_index + this.PAGE_NUM * 3 < this.value_set.length &&\n            this.content.y >= this.start_y + this.PAGE_NUM * 1.5 * this.OPT_HEIGHT) { // 动态加载\n            if (this.scroll_view.isAutoScrolling()) { // 等待这个自动滚动结束以后再做加载\n                this.scroll_view.elastic = false; // 暂时关闭回弹效果\n                return;\n            }\n\n            var down_loaded = this.PAGE_NUM;\n            this.start_index += down_loaded;\n            if (this.start_index + this.PAGE_NUM * 3 > this.value_set.length) {\n                var out_len = this.start_index + this.PAGE_NUM * 3 - this.value_set.length;\n                down_loaded -= (out_len);\n                this.start_index -= (out_len);\n            }\n            this.load_record(this.start_index);\n\n            this.content.y -= (down_loaded * this.OPT_HEIGHT);\n            return;\n        }\n\n        // 向上加载\n        if (this.start_index > 0 && this.content.y <= this.start_y) {\n            if (this.scroll_view.isAutoScrolling()) { // 等待这个自动滚动结束以后再做加载\n                this.scroll_view.elastic = false;\n                return;\n            }\n\n            var up_loaded = this.PAGE_NUM;\n            this.start_index -= up_loaded;\n            if (this.start_index < 0) {\n                up_loaded += this.start_index;\n                this.start_index = 0; \n            }\n            this.load_record(this.start_index);\n            this.content.y += (up_loaded * this.OPT_HEIGHT);\n        }\n        // end \n    }\n    // called every frame, uncomment this function to activate update callback\n    update(dt) {\n        if(this.childNum > 0)\n          this.scrollveiw_load_recode();\n    }\n}\n"]}