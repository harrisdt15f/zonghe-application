{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\Hall\\shop/assets\\Script\\Hall\\shop\\ShopWebView.js"],"names":["cc","sys","isBrowser","window","addEventListener","e","console","log","data","closeWebView","Class","extends","Component","properties","webView","WebView","debugText","Label","start","setDebugText","url","init","scheme","jsCallback","target","str","replace","setJavascriptInterfaceScheme","setOnJSCallback","bind","string","cocosToWeb","width","node","height","isNative","color","text","_sgNode","_renderCmd","_iframe","contentWindow","postMessage","JSON","stringify","evaluateJS","active","onWebFinishLoad","sender","event","EventType","LOADED","LOADING","ERROR"],"mappings":"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","file":"ShopWebView.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Hall\\shop","sourcesContent":["if (cc.sys.isBrowser) {\r\n    window.addEventListener('message', function (e) {\r\n        console.log(\"----cocos---\",e.data);\r\n        window.closeWebView(e);\r\n    })\r\n}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        webView: cc.WebView,\r\n        debugText: cc.Label\r\n    },\r\n\r\n    start() {\r\n        this.setDebugText(\"start.....\")\r\n        this.webView.url = \"web ip 地址\"; \r\n        this.init();\r\n    },\r\n\r\n    init() {\r\n        var scheme = \"testkey\";\r\n        function jsCallback(target, url) {\r\n            var str = url.replace(scheme + '://', ''); // str === 'a=1&b=2'\r\n            // webview target\r\n            console.log(\"jsCallback-------str-------\", str);\r\n            window.closeWebView(target, url);\r\n        }\r\n        this.webView.setJavascriptInterfaceScheme(scheme);\r\n        this.webView.setOnJSCallback(jsCallback);\r\n\r\n        //web\r\n        window.closeWebView = this.closeWebView.bind(this);\r\n    },\r\n\r\n    setDebugText(str) {\r\n        this.debugText.string = str\r\n    },\r\n\r\n    //绑定按钮\r\n    cocosToWeb() {  \r\n        let data = {\r\n            width: this.webView.node.width,\r\n            height: this.webView.node.height,\r\n            isNative: cc.sys.isNative,\r\n            color:\"#FF9800\"\r\n        }\r\n        let text;\r\n        console.log(\"------cocos------data-----------\", data)\r\n        //浏览器\r\n        if (cc.sys.isBrowser) {\r\n            console.log(\"-----cocos------Browser---------\");\r\n            text = \"-----cocos------Browser---------\";\r\n            this.webView._sgNode._renderCmd._iframe.contentWindow.postMessage(data, \"*\");\r\n        } \r\n        //移动端\r\n        else if (cc.sys.isNative) \r\n        { \r\n            console.log(\"-----cocos------Native---------\");\r\n            text = \"-----cocos------Native---------\";\r\n            data = JSON.stringify(data);\r\n            //setBackgroundColor 是 web 全局函数， data 参数\r\n            this.webView.evaluateJS(\"setBackgroundColor(\" + data + \")\");\r\n        }\r\n\r\n        this.webView.node.active = true;\r\n        this.setDebugText(text)\r\n    },\r\n\r\n    //关闭WebView\r\n    closeWebView(e, url) {\r\n        this.webView.node.active = false;\r\n        this.setDebugText(\"--------cocos-----close----webView-------\" + url);\r\n    },\r\n\r\n    //事件\r\n    onWebFinishLoad: function (sender, event) {\r\n        if (event === cc.WebView.EventType.LOADED) {\r\n            this.setDebugText(\"----webView---loaded---finish!!----\")\r\n            this.cocosToWeb()\r\n        } else if (event === cc.WebView.EventType.LOADING) {\r\n            this.setDebugText(\"----webView---loading----\")\r\n        } else if (event === cc.WebView.EventType.ERROR) {\r\n            this.setDebugText(\"----webView---load---error----\")\r\n        }\r\n    },\r\n\r\n});"]}