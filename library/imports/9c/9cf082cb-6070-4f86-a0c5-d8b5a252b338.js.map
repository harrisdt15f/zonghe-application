{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Hall/assets\\Script\\Hall\\WebNode.js"],"names":["cc","sys","isBrowser","window","addEventListener","e","console","log","data","closeWebView","Class","extends","Component","properties","webView","WebView","debugText","Label","start","setDebugText","scheme","jsCallback","target","url","str","replace","setJavascriptInterfaceScheme","setOnJSCallback","bind","string","init","_url","cocosToWeb","width","node","height","isNative","color","text","_impl","_iframe","contentWindow","postMessage","JSON","stringify","evaluateJS","active","onWebFinishLoad","sender","event","EventType","LOADED","LOADING","ERROR"],"mappings":";;;;;;AAAA,IAAIA,GAAGC,GAAH,CAAOC,SAAX,EAAsB;AAClB;AACAC,WAAOC,gBAAP,CAAwB,SAAxB,EAAmC,UAAUC,CAAV,EAAa;AAC5CC,gBAAQC,GAAR,CAAY,cAAZ,EAA2BF,EAAEG,IAA7B;AACAL,eAAOM,YAAP,CAAoBJ,CAApB;AACH,KAHD;AAIH;;AAEDL,GAAGU,KAAH,CAAS;AACLC,aAASX,GAAGY,SADP;;AAGLC,gBAAY;AACRC,iBAASd,GAAGe,OADJ;AAERC,mBAAWhB,GAAGiB;AAFN,KAHP;;AASLC,SATK,mBASG;AACJ,aAAKC,YAAL,CAAkB,YAAlB;AACD;AACC;AACA,YAAIC,SAAS,SAAb;AACA;AACA,iBAASC,UAAT,CAAoBC,MAApB,EAA4BC,GAA5B,EAAiC;AAC7B;AACA,gBAAIC,MAAMD,IAAIE,OAAJ,CAAYL,SAAS,KAArB,EAA4B,EAA5B,CAAV,CAF6B,CAEc;AAC3C;AACAd,oBAAQC,GAAR,CAAY,6BAAZ,EAA2CiB,GAA3C;AACArB,mBAAOM,YAAP,CAAoBa,MAApB,EAA4BC,GAA5B;AACH;AACD,aAAKT,OAAL,CAAaY,4BAAb,CAA0CN,MAA1C;AACA,aAAKN,OAAL,CAAaa,eAAb,CAA6BN,UAA7B;;AAEA;AACAlB,eAAOM,YAAP,GAAsB,KAAKA,YAAL,CAAkBmB,IAAlB,CAAuB,IAAvB,CAAtB;AACH,KA3BI;AA6BLT,gBA7BK,wBA6BQK,GA7BR,EA6Ba;AACd,aAAKR,SAAL,CAAea,MAAf,GAAwBL,GAAxB;AACH,KA/BI;AAgCLM,QAhCK,gBAgCAC,IAhCA,EAiCL;AACI,aAAKjB,OAAL,CAAaS,GAAb,GAAmBQ,IAAnB;AACA,aAAKC,UAAL;AACH,KApCI;;;AAsCL;AACAA,cAvCK,wBAuCQ;AACT,YAAIxB,OAAO;AACPyB,mBAAO,KAAKnB,OAAL,CAAaoB,IAAb,CAAkBD,KADlB;AAEPE,oBAAQ,KAAKrB,OAAL,CAAaoB,IAAb,CAAkBC,MAFnB;AAGPC,sBAAUpC,GAAGC,GAAH,CAAOmC,QAHV;AAIPC,mBAAM;AAJC,SAAX;AAMA,YAAIC,aAAJ;AACAhC,gBAAQC,GAAR,CAAY,kCAAZ,EAAgDC,IAAhD;AACA;AACA,YAAIR,GAAGC,GAAH,CAAOC,SAAX,EAAsB;AAClBI,oBAAQC,GAAR,CAAY,kCAAZ;AACA+B,mBAAO,kCAAP;AACD;AACC;AACT,iBAAKxB,OAAL,CAAayB,KAAb,CAAmBC,OAAnB,CAA2BC,aAA3B,CAAyCC,WAAzC,CAAqDlC,IAArD,EAA2D,GAA3D;AACM;AACD;AAPA,aAQK,IAAIR,GAAGC,GAAH,CAAOmC,QAAX,EACL;AACI9B,wBAAQC,GAAR,CAAY,iCAAZ;AACA+B,uBAAO,iCAAP;AACA9B,uBAAOmC,KAAKC,SAAL,CAAepC,IAAf,CAAP;AACA;AACA,qBAAKM,OAAL,CAAa+B,UAAb,CAAwB,wBAAwBrC,IAAxB,GAA+B,GAAvD;AACH;;AAED,aAAKM,OAAL,CAAaoB,IAAb,CAAkBY,MAAlB,GAA2B,IAA3B;AACA,aAAK3B,YAAL,CAAkBmB,IAAlB;AACH,KApEI;;;AAsEL;AACA7B,gBAvEK,wBAuEQJ,CAvER,EAuEWkB,GAvEX,EAuEgB;AACjB,aAAKT,OAAL,CAAaoB,IAAb,CAAkBY,MAAlB,GAA2B,KAA3B;AACA,aAAK3B,YAAL,CAAkB,8CAA8CI,GAAhE;AACH,KA1EI;;;AA4EL;AACAwB,qBAAiB,yBAAUC,MAAV,EAAkBC,KAAlB,EAAyB;AACtC,YAAIA,UAAUjD,GAAGe,OAAH,CAAWmC,SAAX,CAAqBC,MAAnC,EAA2C;AACvC,iBAAKhC,YAAL,CAAkB,qCAAlB;AACA,iBAAKa,UAAL;AACH,SAHD,MAGO,IAAIiB,UAAUjD,GAAGe,OAAH,CAAWmC,SAAX,CAAqBE,OAAnC,EAA4C;AAC/C,iBAAKjC,YAAL,CAAkB,2BAAlB;AACH,SAFM,MAEA,IAAI8B,UAAUjD,GAAGe,OAAH,CAAWmC,SAAX,CAAqBG,KAAnC,EAA0C;AAC7C,iBAAKlC,YAAL,CAAkB,gCAAlB;AACH;AACJ;;AAtFI,CAAT","file":"WebNode.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Hall","sourcesContent":["if (cc.sys.isBrowser) {\r\n    //这里是浏览器环境下， 接收web传过来的消息\r\n    window.addEventListener('message', function (e) {\r\n        console.log(\"----cocos---\",e.data);\r\n        window.closeWebView(e);\r\n    })\r\n}\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        webView: cc.WebView,\r\n        debugText: cc.Label\r\n    },\r\n\r\n\r\n    start() {\r\n        this.setDebugText(\"start.....\")\r\n       //this.webView.url = _url; // 如: \"http://127.0.0.1:8190/web/\"\r\n        // 这里是与内部页面约定的关键字，请不要使用大写字符，会导致 location 无法正确识别。\r\n        var scheme = \"testkey\";\r\n        //这里是移动端， 接收web传过来的消息\r\n        function jsCallback(target, url) {\r\n            // 这里的返回值是内部页面的 URL 数值，需要自行解析自己需要的数据。\r\n            var str = url.replace(scheme + '://', ''); // str === 'a=1&b=2'\r\n            // webview target\r\n            console.log(\"jsCallback-------str-------\", str);\r\n            window.closeWebView(target, url);\r\n        }\r\n        this.webView.setJavascriptInterfaceScheme(scheme);\r\n        this.webView.setOnJSCallback(jsCallback);\r\n\r\n        //web\r\n        window.closeWebView = this.closeWebView.bind(this);\r\n    },\r\n\r\n    setDebugText(str) {\r\n        this.debugText.string = str\r\n    },\r\n    init(_url)\r\n    {\r\n        this.webView.url = _url;\r\n        this.cocosToWeb();\r\n    },\r\n\r\n    //绑定按钮\r\n    cocosToWeb() {  \r\n        let data = {\r\n            width: this.webView.node.width,\r\n            height: this.webView.node.height,\r\n            isNative: cc.sys.isNative,\r\n            color:\"#FF9800\"\r\n        }\r\n        let text;\r\n        console.log(\"------cocos------data-----------\", data)\r\n        //浏览器\r\n        if (cc.sys.isBrowser) {\r\n            console.log(\"-----cocos------Browser---------\");\r\n            text = \"-----cocos------Browser---------\";\r\n           // this.webView._sgNode._renderCmd._iframe.contentWindow.postMessage(data, \"*\");\r\n            //如果因为版本原因 _sgNode 被舍弃了，可以换成以下\r\n\t\t\tthis.webView._impl._iframe.contentWindow.postMessage(data, \"*\");\r\n        } \r\n        //移动端\r\n        else if (cc.sys.isNative) \r\n        { \r\n            console.log(\"-----cocos------Native---------\");\r\n            text = \"-----cocos------Native---------\";\r\n            data = JSON.stringify(data);\r\n            //setBackgroundColor 是 web 全局函数， data 参数\r\n            this.webView.evaluateJS(\"setBackgroundColor(\" + data + \")\");\r\n        }\r\n\r\n        this.webView.node.active = true;\r\n        this.setDebugText(text)\r\n    },\r\n\r\n    //关闭WebView\r\n    closeWebView(e, url) {\r\n        this.webView.node.active = false;\r\n        this.setDebugText(\"--------cocos-----close----webView-------\" + url);\r\n    },\r\n\r\n    //事件\r\n    onWebFinishLoad: function (sender, event) {\r\n        if (event === cc.WebView.EventType.LOADED) {\r\n            this.setDebugText(\"----webView---loaded---finish!!----\")\r\n            this.cocosToWeb()\r\n        } else if (event === cc.WebView.EventType.LOADING) {\r\n            this.setDebugText(\"----webView---loading----\")\r\n        } else if (event === cc.WebView.EventType.ERROR) {\r\n            this.setDebugText(\"----webView---load---error----\")\r\n        }\r\n    },\r\n\r\n});\r\n"]}