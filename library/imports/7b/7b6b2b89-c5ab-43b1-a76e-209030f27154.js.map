{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\Hall\\Activity/assets\\Script\\Hall\\Activity\\RedWarsBox.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Hall\\Activity","sourcesContent":["\n\nimport { G_Utils } from '../../Tool/Utils';\nimport { G_OnFire } from '../../Net/OnFire';\nimport { uiEventFunction} from '../../Config/uiEvent';\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class RedWarsBox extends cc.Component {\n\n    @property(cc.Node)\n    hb:cc.Node = null;\n\n    @property(cc.Node)\n    peanl:cc.Node = null;\n\n    @property(cc.Node)\n    OpenGuessing:cc.Node = null;\n\n    @property(cc.SpriteAtlas)\n    numImage : cc.SpriteAtlas = null;\n\n    @property(cc.Animation)\n    yellowHalo : cc.Animation = null;\n\n    @property(cc.Node)\n    imageNum : cc.Node = null;\n\n    private _updateflag = false;\n    private _clickFlag = true;\n    private _dt = 0;\n    private _time = 10;\n    // private count = 0;\n\n    private _pool : cc.NodePool = null;\n    private tempArray : cc.Node[] = [];\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n\n        this.peanl.on(cc.Node.EventType.TOUCH_START, this._onTouchBegin, this);\n        G_OnFire.on(uiEventFunction.awardClose,this.onCloseAwardNode.bind(this))\n    }\n\n    start () {\n\n    }\n\n    update (dt) {\n        if(this._updateflag && this._clickFlag){\n            this._dt += dt\n            if(this._dt >= 1){\n                this._time--;\n                this._dt = 0;\n            }\n            if(this._time <= 5 ){\n                this.yellowHalo.node.active = true;\n                this.imageNum.getComponent(cc.Sprite).spriteFrame = this.numImage.getSpriteFrame(String(this._time));\n            }\n            if(this._time < 0){\n                this.onCloseAwardNode();\n            }\n        }\n    }\n\n    onEnable(){\n        this.yellowHalo.play();\n        this._updateflag = true;\n        this._clickFlag = true;\n        this._time = 10;\n        this._dt = 0;\n        this._pool = new cc.NodePool();\n        this.dropOut();\n    }\n\n    onDestroy() {\n        console.log(\"销毁\")\n        this.peanl.off(cc.Node.EventType.TOUCH_START, this._onTouchBegin, this);\n        G_OnFire.off(uiEventFunction.awardClose)\n        while (this._pool.size()) {\n            let node = this._pool.get();\n            node.destroy();\n        }\n    }\n\n\n    nodePollPut(_item:cc.Node){\n        if(!_item)\n            return;\n    \n        this.tempArray.push(_item)\n        _item.parent = this.peanl;\n    \n        var x = G_Utils.random(0, 1400)\n        var rotation = G_Utils.random(0, 90)\n        var scale = G_Utils.random(100, 120)\n        _item.x = x\n        _item.y = 800\n        _item.scale = scale / 100\n        _item.angle = rotation;\n\n        var speed = G_Utils.random(150,500) \n        speed = speed / 100;\n\n        var move = cc.moveTo(speed, x, -80)\n        var cFunc = cc.callFunc(function(target){\n            this.peanl.removeChild(target, false)\n            this.tempArray.forEach(function(value,index){\n                if(value === target){\n                    this.tempArray.splice(index-1,index)\n                }\n            },this);\n        },this, _item)\n        var sseq = cc.sequence(move, cFunc)\n        _item.runAction(sseq)\n    }\n\n    dropOut(){\n        var func = cc.callFunc(function (target) {\n            if(this._pool.size()){\n                var item = this._pool.get()\n                this.nodePollPut(item);\n            }else{\n                var _item  = cc.instantiate(this.hb);\n                this._pool.put(_item);\n                var item = this._pool.get()\n                this.nodePollPut(item);\n            }\n        }, this);\n\n        var seq = cc.sequence(cc.delayTime(0.5), func)\n        var repeatf = cc.repeatForever(seq)\n        this.peanl.runAction(repeatf);\n    }\n\n    _onTouchBegin(event){\n        //获取当前点击的全局坐标\n        this.tempArray.forEach(element => {\n            if(element.getBoundingBoxToWorld().contains(event.getLocation())){\n                this.OpenGuessing.active = true;\n                this._clickFlag = false;\n                this.peanl.stopAllActions()\n                element.stopAllActions()\n                this.yellowHalo.stop();\n                return;\n            }\n        }, this);\n    }\n\n    onCloseAwardNode(){\n        this._clickFlag = false;\n        this.yellowHalo.node.active = false;\n        this.yellowHalo.stop();\n        this.peanl.removeAllChildren(false)\n        this.peanl.stopAllActions()\n        while (this._pool.size()) {\n            let node = this._pool.get();\n            node.destroy();\n        }\n        this.node.active = false;\n    }\n\n}\n"]}